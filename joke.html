<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶£å‘³ - Left</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="theme-color" content="#4d94ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(-45deg, #ffcce6, #b3e0ff, #ffcce6, #99d6ff);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            transform: translateZ(0);
            -webkit-font-smoothing: antialiased;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .joke-container {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 102, 179, 0.15);
            width: min(90vw, 600px);
            position: relative;
            will-change: transform;
            backface-visibility: hidden;
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .joke-text {
            font-size: clamp(1rem, 4vw, 1.5rem);
            color: #ff6699;
            margin: 20px;
            line-height: 1.6;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.8),
                        -1px -1px 0 rgba(255, 255, 255, 0.8);
            font-family: 'Ma Shan Zheng', cursive;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .punchline {
            display: block;
            opacity: 0;
            font-size: 1.2rem;
            color: #ff99cc;
            margin-top: 10px;
            will-change: opacity;
        }

        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-right: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #ff6699;
            box-shadow: 0 2px 4px rgba(255, 102, 179, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-weight: bold;
        }

        .new-quote, .delay-button, .control-button, .hint-button {
            padding: 12px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 25px;
            background: linear-gradient(120deg, #ff99cc, #99ccff);
            color: white;
            font-family: 'Ma Shan Zheng', cursive;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(255, 153, 204, 0.2);
            position: relative;
            overflow: hidden;
        }

        .new-quote:hover, .delay-button:hover, .control-button:hover, .hint-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 153, 204, 0.3);
            background: linear-gradient(120deg, #ff80bf, #80bfff);
        }

        .delay-button {
            display: none;
        }

        .delay-button:disabled {
            background: linear-gradient(120deg, #ffcccc, #ccccff);
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
            opacity: 0.7;
        }

        .countdown {
            font-size: 1rem;
            color: #ff6699;
            margin-top: 15px;
            opacity: 0.8;
            font-style: italic;
            font-family: 'Ma Shan Zheng', cursive;
        }

        .home-button {
            position: fixed;
            right: 20px;
            bottom: 20px;
            background: linear-gradient(135deg, rgba(255, 153, 204, 0.2), rgba(153, 204, 255, 0.2));
            backdrop-filter: blur(8px);
            color: #ff6699;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Ma Shan Zheng', cursive;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .home-button:hover {
            opacity: 1 !important;
            background: linear-gradient(135deg, #ff99cc, #99ccff);
            color: white;
            transform: translateY(-2px);
        }

        .joke-text.flipping {
            transform: rotateX(90deg);
        }

        .quote-text {
            display: inline-block;
            opacity: 0;
            animation: none;
            will-change: opacity, transform;
            -webkit-font-smoothing: subpixel-antialiased;
            animation: fadeIn 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0;
                transform: translateY(10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from { 
                opacity: 1;
                transform: translateY(0);
            }
            to { 
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        @keyframes fadeInPunchline {
            from { 
                opacity: 0;
                transform: translateY(5px);
            }
            to { 
                opacity: 0.8;
                transform: translateY(0);
            }
        }

        .heart {
            position: absolute;
            font-size: 2rem;
            animation: float 3s ease-in-out infinite;
            opacity: 0.6;
            filter: drop-shadow(0 0 10px rgba(77, 148, 255, 0.8));  /* è“è‰²é˜´å½± */
            text-shadow: 0 0 10px rgba(77, 148, 255, 0.8),
                        0 0 20px rgba(77, 148, 255, 0.5),
                        0 0 30px rgba(77, 148, 255, 0.3);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(20deg); }
        }

        .mouse-emoji {
            position: fixed;
            pointer-events: none;
            font-size: 20px;
            z-index: 1000;
            animation: floatUp 1s ease-out forwards;
            will-change: transform, opacity;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px) scale(1.2);
                opacity: 0;
            }
        }

        .animated {
            animation-timing-function: cubic-bezier(0.4, 0.0, 0.2, 1);
            will-change: transform, opacity;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        @media (max-width: 768px) {
            .joke-container {
                padding: 1.5rem;
            }

            .delay-button {
                margin-top: 10px;
                margin-left: 0;
            }

            .countdown {
                font-size: 0.9rem;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* æŒ‰é’®åŸºç¡€æ ·å¼ */
        button {
            padding: 10px 20px;
            font-size: 1.2rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(77, 148, 255, 0.2);
            margin: 0 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(77, 148, 255, 0.3);
        }

        button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(77, 148, 255, 0.2);
        }

        .delay-button {
            background: linear-gradient(135deg, #80b3ff, #4d94ff);
            color: white;
            opacity: 0.9;
            display: none;
        }

        .delay-button:hover {
            background: linear-gradient(135deg, #4d94ff, #3385ff);
        }

        .delay-button:disabled {
            background: #e0e0e0;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
            opacity: 0.7;
        }

        /* è¿”å›é¦–é¡µæŒ‰é’®æ ·å¼ä¼˜åŒ– */
        .home-button {
            position: fixed;
            right: 20px;
            bottom: 20px;
            background: linear-gradient(135deg, rgba(77, 148, 255, 0.1), rgba(77, 148, 255, 0.2));
            backdrop-filter: blur(8px);
            color: #4d94ff;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1rem;
            padding: 8px 16px;
        }

        .home-button:hover {
            opacity: 1 !important;
            background: linear-gradient(135deg, #4d94ff, #3385ff);
            color: white;
            transform: translateY(-2px);
        }

        /* é’®ç»„å¸ƒå±€ä¼˜åŒ– */
        .button-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* ä¼˜åŒ–æŒ‰é’®ç¦ç”¨çŠ¶æ€æ ·å¼ */
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* æ·»åŠ ç‚¹èµåŠŸèƒ½æ ·å¼ */
        .like-button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .like-button:hover {
            transform: scale(1.2);
            opacity: 1;
        }

        .like-button.liked {
            color: #ff6b6b;
            animation: heartBeat 0.3s ease;
        }

        @keyframes heartBeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* æ·»åŠ åˆ†äº«åŠŸèƒ½æ ·å¼ */
        .share-button {
            background: linear-gradient(135deg, #80b3ff, #4d94ff);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .joke-container:hover .share-button {
            opacity: 0.8;
        }

        /* åˆ†ç±»æ ‡ç­¾ç³»ç»Ÿä¼˜åŒ– */
        .category-tabs {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 25px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 30px;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(255, 102, 179, 0.1);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
            overflow: hidden;
            isolation: isolate;
        }

        /* æ»‘åŠ¨æŒ‡ç¤ºå™¨ä¼˜åŒ– */
        .category-tabs::before {
            content: '';
            position: absolute;
            height: calc(100% - 10px);
            background: linear-gradient(120deg, rgba(255, 153, 204, 0.3), rgba(153, 204, 255, 0.3));
            border-radius: 20px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
            width: calc(25% - 10px);
            top: 5px;
            left: 5px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .category-tabs[data-active="all"]::before { left: 5px; }
        .category-tabs[data-active="riddle"]::before { left: calc(25% + 2px); }
        .category-tabs[data-active="proverb"]::before { left: calc(50% - 1px); }
        .category-tabs[data-active="trivia"]::before { left: calc(75% - 4px); }

        .tab {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            color: #ff6699;
            font-size: 1rem;
            font-family: 'Ma Shan Zheng', cursive;
            position: relative;
            overflow: hidden;
            flex: 1;
            min-width: 80px;
            z-index: 1;
        }

        .tab:hover {
            transform: translateY(-1px);
            text-shadow: 0 2px 4px rgba(255, 102, 179, 0.2);
        }

        .tab.active {
            color: white;
            transform: translateY(-2px);
            text-shadow: 0 2px 4px rgba(255, 255, 255, 0.3);
        }

        /* æ ‡ç­¾å†…å®¹åˆ‡æ¢æ•ˆæœ */
        .joke-text {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }

        .joke-text.switching {
            opacity: 0;
            transform: scale(0.95) translateY(10px);
            filter: blur(2px);
        }

        /* æ ‡ç­¾åˆ‡æ¢æ—¶çš„æ³¢çº¹æ•ˆæœ */
        .tab::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.7) 0%, transparent 70%);
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            pointer-events: none;
            transition: transform 0.6s ease-out, opacity 0.6s ease-out;
        }

        .tab:active::after {
            transform: translate(-50%, -50%) scale(2);
            opacity: 0;
        }

        /* ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ– */
        @media (max-width: 768px) {
            .category-tabs {
                flex-wrap: nowrap;
                gap: 8px;
                padding: 8px;
                width: 90%;
            }

            .tab {
                padding: 8px 15px;
                font-size: 0.9rem;
                min-width: unset;
            }
        }

        /* æ¸¸æˆç±»å‹é€‰æ‹©å™¨ä¼˜ */
        .game-type-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 35px;
            backdrop-filter: blur(8px);
            box-shadow: 0 6px 20px rgba(77, 148, 255, 0.15);
        }

        .type-button {
            padding: 12px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 25px;
            background: transparent;
            color: #4d94ff;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Ma Shan Zheng', cursive;
            position: relative;
            overflow: hidden;
        }

        .type-button:hover {
            background: rgba(77, 148, 255, 0.1);
            transform: translateY(-1px);
        }

        .type-button.active {
            background: linear-gradient(120deg, #ff99cc, #99ccff);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 153, 204, 0.3);
        }

        /* æŒ‰é’®ç‚¹å‡»æ³¢çº¹æ•ˆ */
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(100, 100);
                opacity: 0;
            }
        }

        /* æ¸¸æˆå¼€å§‹ç•Œé¢æ ·å¼ */
        .game-start {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(77, 148, 255, 0.1);
        }

        .game-start h2 {
            color: #4d94ff;
            font-size: 1.8em;
            margin-bottom: 20px;
            font-family: 'Ma Shan Zheng', cursive;
        }

        .level-select {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .level-button {
            padding: 15px 30px;
            font-size: 1.2em;
            background: linear-gradient(120deg, #ff99cc, #99ccff);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .level-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(77, 148, 255, 0.3);
        }

        .game-info {
            text-align: left;
            margin-top: 30px;
            padding: 20px;
            background: rgba(77, 148, 255, 0.1);
            border-radius: 15px;
        }

        .game-info p {
            color: #4d94ff;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .game-info ul {
            list-style-type: none;
            padding: 0;
        }

        .game-info li {
            color: #666;
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .game-info li:before {
            content: "â€¢";
            color: #4d94ff;
            position: absolute;
            left: 0;
        }

        /* åŠ è½½è¿›åº¦æç¤ºæ ·å¼ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #ff99cc;
            border-top-color: #99ccff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            margin-top: 20px;
            font-family: 'Ma Shan Zheng', cursive;
            color: #ff6699;
            font-size: 1.2em;
        }

        .loading-progress {
            margin-top: 10px;
            width: 200px;
            height: 4px;
            background: rgba(255, 153, 204, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff99cc, #99ccff);
            width: 0;
            transition: width 0.3s ease;
        }

        /* ç»Ÿä¸€æŒ‰é’®æ ·å¼ */
        .control-button, .hint-button, .level-button {
            padding: 12px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 25px;
            background: linear-gradient(120deg, #ff99cc, #99ccff);
            color: white;
            font-family: 'Ma Shan Zheng', cursive;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(255, 153, 204, 0.2);
            position: relative;
            overflow: hidden;
        }

        .control-button:hover, .hint-button:hover, .level-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 153, 204, 0.3);
            background: linear-gradient(120deg, #ff80bf, #80bfff);
        }

        .control-button:active, .hint-button:active, .level-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(255, 153, 204, 0.2);
        }

        /* æŒ‰é’®æ³¢çº¹æ•ˆæœ */
        .control-button::after, .hint-button::after, .level-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.7) 0%, transparent 70%);
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            pointer-events: none;
            transition: transform 0.6s ease-out, opacity 0.6s ease-out;
        }

        .control-button:active::after, .hint-button:active::after, .level-button:active::after {
            transform: translate(-50%, -50%) scale(2);
            opacity: 0;
        }

        /* è‡ªå®šä¹‰æç¤ºæ¡†æ ·å¼ */
        .custom-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 102, 179, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            min-width: 300px;
            font-family: 'Ma Shan Zheng', cursive;
        }

        .custom-alert.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .custom-alert-title {
            color: #ff6699;
            font-size: 1.4em;
            margin-bottom: 15px;
        }

        .custom-alert-content {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .custom-alert-button {
            padding: 10px 25px;
            background: linear-gradient(120deg, #ff99cc, #99ccff);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            font-size: 1.1em;
        }

        .custom-alert-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 153, 204, 0.3);
        }

        /* é«˜ç³Šé®ç½© */
        .blur-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(8px);
            background: rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 999;
        }

        .blur-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        /* ä¼˜åŒ–æ€§èƒ½ */
        .game-container, .joke-container {
            will-change: transform, opacity;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        /* å¢åŠ è¿‡æ¸¡åŠ¨ç”» */
        .transition-fade {
            transition: opacity 0.3s ease, transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ä¼˜åŒ–å›¾ç‰‡è½½ */
        .game-image {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .game-image.loaded {
            opacity: 1;
        }

        /* ç»Ÿä¸€æŒ‰é’®æ ·å¼ */
        .new-quote, .delay-button {
            padding: 12px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 25px;
            background: linear-gradient(120deg, #ff99cc, #99ccff);
            color: white;
            font-family: 'Ma Shan Zheng', cursive;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(255, 153, 204, 0.2);
            position: relative;
            overflow: hidden;
        }

        .new-quote:hover, .delay-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 153, 204, 0.3);
            background: linear-gradient(120deg, #ff80bf, #80bfff);
        }

        .delay-button {
            display: none;
        }

        .delay-button:disabled {
            background: linear-gradient(120deg, #ffcccc, #ccccff);
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
            opacity: 0.7;
        }

        /* æŒ‰é’®æ³¢çº¹æ•ˆæœ */
        .new-quote::after, .delay-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.7) 0%, transparent 70%);
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            pointer-events: none;
            transition: transform 0.6s ease-out, opacity 0.6s ease-out;
        }

        .new-quote:active::after, .delay-button:active::after {
            transform: translate(-50%, -50%) scale(2);
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="joke-container">
        <div id="joke-content">
            <div class="joke-text" id="joke-quote"></div>
            <div class="countdown" id="countdown"></div>
            <div class="button-group">
                <button class="new-quote" onclick="generateQuote()">å†æ¥ä¸€ä¸ª</button>
                <button class="delay-button" onclick="delayAnswer()" id="delay-btn">å»¶æ—¶5ç§’</button>
            </div>
        </div>
    </div>
    <button class="home-button" onclick="window.location.href='index.html'">è¿”å›é¦–é¡µ</button>

    <script>
        // æ¸¸æˆæ•°æ®é…ç½®
        const DEFAULT_DATA = {
            spotDiff: [
                {
                    title: "å¯çˆ±å°çŒ«",
                    image1: "https://robohash.org/cat1?set=set4",
                    image2: "https://robohash.org/cat2?set=set4",
                    differences: [
                        { x: 120, y: 150, radius: 20, hint: "é¡¹åœˆé¢œè‰²ä¸åŒ" },
                        { x: 250, y: 180, radius: 25, hint: "è€³æœµå§¿åŠ¿ä¸åŒ" },
                        { x: 180, y: 220, radius: 20, hint: "çˆªå­ä½ç½®ä¸åŒ" }
                    ],
                    timeLimit: 30,
                    difficulty: "ç®€å•"
                },
                {
                    title: "èŒèŒå°ç‹—",
                    image1: "https://robohash.org/dog1?set=set1",
                    image2: "https://robohash.org/dog2?set=set1",
                    differences: [
                        { x: 200, y: 160, radius: 25, hint: "å°¾å·´å§¿åŠ¿ä¸åŒ" },
                        { x: 150, y: 200, radius: 20, hint: "çœ¼ç›é¢œè‰²ä¸åŒ" },
                        { x: 280, y: 190, radius: 22, hint: "ç©å…·ä½ç½®ä¸åŒ" }
                    ],
                    timeLimit: 35,
                    difficulty: "ç®€å•"
                }
            ]
        };

        const jokeQuotes = [
            "ç¯è°œï¼š'å››å­£å¹³å®‰ï¼ˆæ‰“ä¸€ä¸ªå­—'\nã€Œæ˜¥ï¼šæœ‰å››ä¸ªå­£ï¼Œä¸Šä¸‹éƒ½æ˜¯å¹³å®‰ã€ğŸ®",
            "ç¯è°œï¼š'å°å§ä¸Šè½¿ï¼ˆæ‰“ä¸€ä¸ªå­—ï¼‰'\nã€Œå¨¶ï¼šä¸Šé¢æ˜¯å¥³ï¼Œä¸‹é¢æ˜¯å–ã€ğŸ’",
            "ç¯è°œï¼š'å£åƒï¼ˆæ‰“ä¸€ä¸ªå­—ï¼‰'\nã€Œå’Œï¼šä¸Šä¸‹éƒ½æ˜¯å£ã€ğŸ—£ï¸",
            "ç¯è°œï¼š'æ‚„æ‚„è¯ï¼ˆæ‰“ä¸€ä¸ªå­—ï¼‰'\nã€Œå¯†ï¼šä¸Šä¸‹éƒ½æ˜¯å±±ï¼Œä¸­é—´è€³æœµã€ğŸ‘‚",
            "ç¯è°œï¼š'ä¸€ä¸ªäººè¿‡æ±Ÿï¼ˆæ‰“ä¸€ä¸ªå­—ï¼‰'\nã€Œæ¸¡ï¼šå•äººæ—åŠ åº¦ã€ğŸš£",
            "ç¯è°œï¼š'å¤©é•¿åœ°ä¹…ï¼ˆæ‰“ä¸€ä¸ªå­—ï¼‰'\nã€ŒçŸ—ï¼šä¸‰ä¸ªé•¿ã€ğŸŒŸ",
            "ç¯è°œï¼š'ä¸€å¿ƒä¸€æ„ï¼ˆæ‰“ä¸€ä¸ªå­—ï¼‰'\nã€Œæƒ ï¼šå¿ƒä¸Šä¸‹éƒ½æ˜¯ä¸€ã€ğŸ’­",
            "å¤©ä¸Šä¸‹æ£‰èŠ±ï¼Ÿ\nã€Œè½¯ç»µç»µçš„ä¸æ˜¯å¥½äº‹ã€â„ï¸",
            "æ³¥è©è¨è¿‡æ±Ÿï¼Ÿ\nã€Œè‡ªèº«éš¾ä¿ã€ğŸŒŠ",
            "å¤«å­æ¬å®¶ï¼Ÿ\nã€Œå°½æ˜¯ä¹¦ï¼ˆè¾“ï¼‰ã€ğŸ“š",
            "é˜ç‹çˆ·å‡ºå‘Šç¤ºï¼Ÿ\nã€Œæ­»å®šäº†ã€ğŸ“œ",
            "æ³¥è©è¨èµ°å¤œè·¯ï¼Ÿ\nã€Œè‡ªç…§è‡ªå·±ã€ğŸ®",
            "è€è™æˆ´å¿µç ï¼Ÿ\nã€Œå‡æ…ˆæ‚²ã€ğŸ¯",
            "çŒ´å­ç…§é•œï¼Ÿ\nã€Œè‡ªç…§è‡ªå·±ã€ğŸ’",
            "å†œè°šï¼š'å†¬å¤©ä¸ä¸‹é›ªï¼Œæ˜¥å¤©é­ç½ªçƒ­'\nã€Œè¯´æ˜é›ªå¯¹å†œä½œç‰©çš„é‡è¦æ€§ã€ğŸŒ¾",
            "å†œè°šï¼š'è…Šæœˆé£é›ªå¤§ï¼Œæ¥å¹´å¿…ä¸°æ”¶'\nã€Œè¿™æ˜¯å†œæ°‘æ€»ç»“çš„å¤©æ°”è§„å¾‹ã€ğŸŒ¿",
            "æ°‘è°šï¼š'å†¬ç»ƒä¸‰ä¹ï¼Œå¤ç»ƒä¸‰ä¼'\nã€Œè¯´æ˜é”»ç‚¼è¦æŒä¹‹ä»¥æ’ã€ğŸ’ª",
            "æ°‘è°šï¼š'å†¬åƒèåœå¤åƒå§œï¼Œä¸ç”¨åŒ»ç”Ÿå¼€è¯æ–¹'\nã€Œä¼ ç»Ÿå…»ç”Ÿæ™ºæ…§ã€ğŸ¥•",
            "æ°‘è°šï¼š'æ˜¥ç§ä¸€ç²’ç²Ÿï¼Œç§‹æ”¶ä¸‡é¢—å­'\nã€Œè¯´æ˜å†œæ—¶çš„é‡æ€§ã€ğŸŒ±",
            "æ°‘è°šï¼š'æ¸…æ˜æ–­é›ªï¼Œè°·é›¨æ–­éœœ'\nã€Œè¯´æ˜èŠ‚æ°”çš„ç‰¹ç‚¹ã€ğŸŒ¤ï¸",
            "ä½ çŸ¥é“å—ï¼š'å¤äººå¦‚ä½•åœ¨å†¬å¤©å­˜æ”¾å†°å—ï¼Ÿ'\nã€Œåœ¨åœ°ä¸‹æŒ–çª–ï¼Œç§°ä¸ºå†°çª–ï¼Œå¯ä»¥ä¿å­˜ä¸€å¹´ã€â„ï¸",
            "ä½ çŸ¥é“å—ï¼š'ä¸ºä»€ä¹ˆåŒ—æ–¹å†¬è‡³åƒé¥ºå­ï¼Ÿ'\nã€Œå› ä¸ºé¥ºå­å½¢ä¼¼å¤ä»£çš„é‡‘é”­ï¼Œå¯“æ„ç€è´¢è¿ã€ğŸ¥Ÿ",
            "ä½ çŸ¥é“å—ï¼š'å¤äººæ˜¯æ€ä¹ˆå–æš–çš„ï¼Ÿ'\nã€Œå‘æ˜äº†ç«ç‚•ã€æ‰‹ç‚‰ã€æ±¤å©†å­ç­‰å–æš–å·¥å…·ã€ğŸ”¥",
            "ä½ çŸ¥é“å—ï¼š'äºŒåå››èŠ‚æ°”ä¸ºä»€ä¹ˆè¿™ä¹ˆå‡†ï¼Ÿ'\nã€Œæ˜¯å¤äººè§‚å¯Ÿå¤ªé˜³ä½ç½®æ€»ç»“å‡ºæ¥çš„ã€â˜€ï¸",
            "å†·çŸ¥è¯†ï¼š'å¤ä»£å»ºç­‘ä¸ºä»€ä¹ˆè¦ç”¨æ–—æ‹±ï¼Ÿ'\nã€Œå¯ä»¥åˆ†æ•£æˆ¿å±‹é‡é‡ï¼Œé˜²æ­¢åœ°éœ‡ã€",
            "å†·çŸ¥è¯†ï¼š'ä¸ºä»€ä¹ˆè¦åœ¨æ˜¥èŠ‚è´´ç¦å­—ï¼Ÿ'\nã€Œæœ€æ—©æ˜¯ä¸ºäº†é©±èµ¶ç–«ç—…ï¼Œåæˆä¸ºä¼ ç»Ÿã€ğŸ“",
            "å†·çŸ¥è¯†ï¼š'ä¸­å›½æœ€æ—©çš„å–æš–æ–¹æ˜¯ä»€ä¹ˆï¼Ÿ'\nã€Œç«å¡˜ï¼Œåæ¥å‘å±•æˆç«ç‚•ã€ğŸ ",
            "å†·çŸ¥è¯†ï¼š'ä¸ºä»€ä¹ˆäººåœ¨ç«¯åˆèŠ‚æŒ‚è‰¾è‰ï¼Ÿ'\nã€Œå› ä¸ºè‰¾è‰æœ‰é©±è™«é˜²ç—…çš„åŠŸæ•ˆã€ğŸŒ¿",
            "å†·çŸ¥è¯†ï¼š'ä¸ºä»€ä¹ˆå¤ä»£ç§°é›¨å¤©ä¸ºç“¢æ³¼å¤§é›¨ï¼Ÿ'\nã€Œå› ä¸ºå¤äººç“¢èˆ€æ°´æ—¶çš„æ™¯è±¡å¾ˆåƒã€ğŸŒ§ï¸",
            "å†·çŸ¥è¯†ï¼š'ä¸ºä»€ä¹ˆè¦åœ¨é—¨ä¸Šè´´é—¨ç¥ï¼Ÿ'\nã€Œæºäºç§¦ä»£ï¼Œæœ€æ—©æ˜¯ç”¨æ¡ƒæœ¨é©±é‚ªã€ğŸšª"
        ];

        const RAF = window.requestAnimationFrame || 
                   window.webkitRequestAnimationFrame || 
                   window.mozRequestAnimationFrame;
        
        const fragment = document.createDocumentFragment();
        
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        let currentCountdown = 5; // é»˜è®¤å€’è®¡æ—¶æ—¶é—´
        let countdownInterval; // å€’è®¡æ—¶å®šæ—¶å™¨
        let isCountingDown = false; // æ˜¯å¦æ­£åœ¨å€’è®¡æ—¶
        let delayCount = 0; // å»¶æ—¶ç‚¹å‡»æ¬¡æ•°è®¡æ•°
        
        const countdownTexts = [
            "é™å¾…ç‰‡åˆ»ï¼Œç„æœºå³å°†æ­æ™“",
            "ä¸”å¬æˆ‘æ¥å¦™è§£å³å°†æµ®",
            "è«æ€¥è«èºï¼Œæ™ºæ…§åœ¨é…é…¿",
            "ç¨å€™ç‰‡åˆ»ï¼ŒçœŸæ„å³å°†å‘ˆç°",
            "å±æ°”å‡ç¥ï¼Œç­”æ¡ˆå³æ­"
        ];

        // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ IntersectionObserver å»¶è¿ŸåŠ è½½
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animated');
                }
            });
        });

        // åˆ†ç±»æ ‡ç­¾ç³»ç»Ÿ
        const categories = {
            riddle: 'ç¯è°œ',
            proverb: 'è°šè¯­',
            trivia: 'å†·çŸ¥è¯†'
        };

        function filterByCategory(category) {
            const filteredQuotes = jokeQuotes.filter(quote => {
                if (category === 'riddle') return quote.startsWith('ç¯è°œï¼š');
                if (category === 'proverb') return quote.startsWith('å†œè°šï¼š') || quote.startsWith('æ°‘è°šï¼š');
                if (category === 'trivia') return quote.startsWith('å†·çŸ¥è¯†ï¼š') || quote.startsWith('ä½ çŸ¥é“å—ï¼š');
                return true;
            });
            return filteredQuotes;
        }

        function generateQuote() {
            const quoteElement = document.getElementById('joke-quote');
            if (quoteElement.dataset.animating === 'true') return;
            
            if (window.punchlineTimer) {
                clearTimeout(window.punchlineTimer);
            }
            
            clearInterval(countdownInterval);
            currentCountdown = 5;
            isCountingDown = false;
            delayCount = 0;
            
            const delayBtn = document.getElementById('delay-btn');
            delayBtn.disabled = false;
            delayBtn.textContent = 'å»¶æ—¶5ç§’';
            
            if (quoteElement.innerHTML) {
                quoteElement.dataset.animating = 'true';
                const oldQuoteText = quoteElement.querySelector('.quote-text');
                const oldPunchline = quoteElement.querySelector('.punchline');
                if (oldQuoteText) {
                    oldQuoteText.style.animation = 'fadeOut 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                }
                if (oldPunchline) {
                    oldPunchline.style.animation = 'fadeOut 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                }
                
                setTimeout(() => {
                    updateQuoteContent(quoteElement);
                    startCountdown(quoteElement);
                }, 1200);
            } else {
                updateQuoteContent(quoteElement);
                startCountdown(quoteElement);
            }
        }

        function startCountdown(element) {
            const punchline = element.querySelector('.punchline');
            if (!punchline) return;

            isCountingDown = true;
            const countdownElement = document.getElementById('countdown');
            const randomText = countdownTexts[Math.floor(Math.random() * countdownTexts.length)];
            countdownElement.innerHTML = `${randomText}ï¼ˆ${currentCountdown}ç§’ï¼‰`;

            // éšè—å»¶æ—¶æŒ‰é’®
            const delayBtn = document.getElementById('delay-btn');
            delayBtn.style.display = 'none';

            countdownInterval = setInterval(() => {
                currentCountdown--;
                if (currentCountdown > 0) {
                    countdownElement.innerHTML = `${randomText}ï¼ˆ${currentCountdown}ç§’ï¼‰`;
                    // å½“å€’è®¡æ—¶å‰©ä½™2æ—¶æ˜¾ç¤ºå»¶æ—¶æŒ‰é’®
                    if (currentCountdown <= 2 && delayCount < 3) {
                        delayBtn.style.display = 'inline-block';
                        delayBtn.style.animation = 'fadeIn 0.3s ease forwards';
                    }
                } else {
                    clearInterval(countdownInterval);
                    countdownElement.innerHTML = '';
                    isCountingDown = false;
                    punchline.style.animation = 'fadeInPunchline 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                    delayBtn.style.display = 'none';
                }
            }, 1000);
        }

        // æŠ½ç¦»å†…å®¹æ›´æ–°é€»è¾‘
        function updateQuoteContent(element) {
            const randomQuote = jokeQuotes[Math.floor(Math.random() * jokeQuotes.length)];
            const [question, answer] = randomQuote.split('\n');
            
            const content = document.createElement('div');
            // æ ¹æ®å†…å®¹ç±»å‹æ·»åŠ ä¸åŒçš„æ ·å¼
            let prefix = '';
            if (question.startsWith('ç¯è°œï¼š')) {
                prefix = '<span class="tag">ç¯è°œ</span>';
            } else if (question.startsWith('å†œè°šï¼š') || question.startsWith('æ°‘è°šï¼š')) {
                prefix = '<span class="tag">è°šè¯­</span>';
            } else if (question.startsWith('å†·çŸ¥è¯†ï¼š') || question.startsWith('ä½ çŸ¥é“å—ï¼š')) {
                prefix = '<span class="tag">å†·çŸ¥è¯†</span>';
            }
            
            content.innerHTML = `
                <span class="quote-text animated">${prefix}${question}</span>
                ${answer ? `<div class="punchline animated" style="opacity: 0">${answer}</div>` : ''}
            `;
            
            element.innerHTML = '';
            element.appendChild(content);
            
            // æ ¹æ®æ˜¯å¦æœ‰ç­”æ¡ˆæ¥æ·»åŠ ç±»å
            document.querySelector('.joke-container').classList.toggle('has-answer', !!answer);
            
            // è§‚å¯Ÿæ–°å†…å®¹
            content.querySelectorAll('.animated').forEach(el => observer.observe(el));
            
            // é‡ç½®åŠ¨ç”»ï¿½ï¿½æ€
            setTimeout(() => {
                element.dataset.animating = 'false';
            }, 1200);
        }

        // ä¼˜åŒ–è§¦æ‘¸ä»¶
        document.addEventListener('touchstart', () => {}, {passive: true});
        
        // ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½
        let ticking = false;
        document.addEventListener('scroll', () => {
            if (!ticking) {
                RAF(() => {
                    // å¤„ç†æ»šåŠ¨äº‹ä»¶
                    ticking = false;
                });
                ticking = true;
            }
        }, {passive: true});

        function delayAnswer() {
            if (!isCountingDown) return;
            
            if (delayCount >= 3) {
                return; // å¦‚æœå·²ç»å»¶æ—¶3æ¬¡ï¼Œä¸å“åº”
            }
            
            delayCount++;
            currentCountdown += 5;
            const countdownElement = document.getElementById('countdown');
            const randomText = countdownTexts[Math.floor(Math.random() * countdownTexts.length)];
            countdownElement.innerHTML = `${randomText}ï¼ˆ${currentCountdown}ç§’ï¼‰`;
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬å’ŒçŠ¶æ€
            const delayBtn = document.getElementById('delay-btn');
            delayBtn.style.display = 'none';
            if (delayCount >= 3) {
                delayBtn.disabled = true;
                delayBtn.textContent = 'ä¸èƒ½å†ç­‰äº†';
            } else {
                delayBtn.textContent = `å»¶æ—¶5ç§’ï¼ˆè¿˜å¯å»¶æ—¶${3 - delayCount}æ¬¡ï¼‰`;
            }
        }

        // åˆå§‹åŒ–ä»£ç 
        function init() {
            // ç”Ÿæˆç¬¬ä¸€æ¡å†…å®¹
            const quoteElement = document.getElementById('joke-quote');
            const randomQuote = jokeQuotes[Math.floor(Math.random() * jokeQuotes.length)];
            const [question, answer] = randomQuote.split('\n');
            
            const content = document.createElement('div');
            let prefix = '';
            if (question.startsWith('ç¯è°œï¼š')) {
                prefix = '<span class="tag">ç¯</span>';
            } else if (question.startsWith('å†œè°šï¼š') || question.startsWith('æ°‘è°šï¼š')) {
                prefix = '<span class="tag">è°šè¯­</span>';
            } else if (question.startsWith('å†·çŸ¥è¯†ï¼š') || question.startsWith('ä½ çŸ¥é“å—ï¼š')) {
                prefix = '<span class="tag">å†·çŸ¥è¯†</span>';
            }
            
            content.innerHTML = `
                <span class="quote-text animated" style="opacity: 1">${prefix}${question}</span>
                ${answer ? `<div class="punchline animated" style="opacity: 0">${answer}</div>` : ''}
            `;
            
            quoteElement.appendChild(content);
            
            // æ ¹æ®æ˜¯å¦æœ‰ç­”æ¡ˆæ¥æ·»åŠ ç±»å
            document.querySelector('.joke-container').classList.toggle('has-answer', !!answer);
            
            // å¦‚æœæœ‰ç­”æ¡ˆï¼Œå¯åŠ¨å€’è®¡æ—¶
            if (answer) {
                startCountdown(quoteElement);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ¢åˆ°æ‰¾ä¸åŒæ¸¸æˆ
            const redirectTo = localStorage.getItem('redirect_to');
            if (redirectTo === 'spotDiff') {
                localStorage.removeItem('redirect_to');
                // å…ˆæ˜¾ç¤ºè¶£å‘³çŸ¥è¯†ï¼Œç„¶åå»¶è¿Ÿåˆ‡æ¢åˆ°æ‰¾ä¸åŒ
                setTimeout(() => {
                    switchType('spotDiff');
                }, 500);
            }
            
            // åˆå§‹åŒ–è¶£å‘³çŸ¥è¯†
            generateQuote();
        });

        // æœ¬åœ°å­˜å‚¨åŠŸèƒ½
        const storage = {
            liked: new Set(JSON.parse(localStorage.getItem('likedJokes') || '[]')),
            history: JSON.parse(localStorage.getItem('jokeHistory') || '[]'),
            
            addLiked(joke) {
                this.liked.add(joke);
                localStorage.setItem('likedJokes', JSON.stringify([...this.liked]));
            },
            
            removeLiked(joke) {
                this.liked.delete(joke);
                localStorage.setItem('likedJokes', JSON.stringify([...this.liked]));
            },
            
            addToHistory(joke) {
                this.history.unshift(joke);
                if (this.history.length > 50) this.history.pop();
                localStorage.setItem('jokeHistory', JSON.stringify(this.history));
            }
        };

        // æ·»åŠ éŸ³æ•ˆåé¦ˆ
        const sounds = {
            click: new Audio('path/to/click.mp3'),
            reveal: new Audio('path/to/reveal.mp3'),
            like: new Audio('path/to/like.mp3')
        };

        // æ·»åŠ éœ‡åŠ¨åé¦ˆ
        function vibrate() {
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        // æ·»åŠ å¤åˆ¶åŠŸèƒ½
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            });
        }

        // æ¸¸æˆç±»å‹åˆ‡æ¢
        function switchType(type) {
            const jokeContent = document.getElementById('joke-content');
            const spotdiffContent = document.getElementById('spotdiff-content');
            const buttons = document.querySelectorAll('.type-button');

            // é»˜è®¤æ˜¾ç¤ºè¶£å‘³çŸ¥è¯†
            if (!jokeContent.style.display) {
                jokeContent.style.display = 'block';
                spotdiffContent.style.display = 'none';
            }

            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (type === 'joke') {
                buttons[0].classList.add('active');
                jokeContent.style.display = 'block';
                spotdiffContent.style.display = 'none';
            } else {
                buttons[1].classList.add('active');
                jokeContent.style.display = 'none';
                spotdiffContent.style.display = 'block';
                initSpotDiffGame();
            }
        }

        // æ¸¸æˆå¼€å§‹ç•Œé¢
        function createGameStartUI() {
            const container = document.createElement('div');
            container.className = 'game-start';
            container.innerHTML = `
                <h2>æ‰¾ä¸åŒå°æ¸¸æˆ</h2>
                <div class="level-select">
                    <button class="level-button" onclick="startLevel(0)">ç¬¬ä¸€å…³ï¼šæ˜¥æ—¥åº­é™¢</button>
                    <button class="level-button" onclick="startLevel(1)">ç¬¬äºŒå…³ï¼šæ•°å­—è¿·å®«</button>
                </div>
                <div class="game-info">
                    <p>æ¸¸æˆè¯´æ˜ï¼š</p>
                    <ul>
                        <li>ç‚¹å‡»å‘ç°ä¸¤å¼ å›¾ç‰‡çš„ä¸åŒä¹‹å¤„</li>
                        <li>å…³æœ‰æ—¶é—´é™åˆ¶</li>
                        <li>å¯ä»¥ä½¿ç”¨æç¤ºï¼Œä½†ä¼šæ‰£åˆ†</li>
                    </ul>
                </div>
            `;
            return container;
        }

        // ä¿®æ”¹æ¸¸æˆåˆå§‹åŒ–å‡½æ•°
        async function initSpotDiffGame() {
            const container = document.querySelector('#spotdiff-content');
            if (!container) return;
            
            // åˆ›å»ºåŠ è½½æç¤º
            const loadingOverlay = document.createElement('div');
            loadingOverlay.className = 'loading-overlay';
            loadingOverlay.innerHTML = `
                <div class="loading-spinner"></div>
                <div class="loading-text">æ­£åœ¨åŠ è½½æ¸¸æˆå›¾ç‰‡...</div>
                <div class="loading-progress">
                    <div class="loading-progress-bar"></div>
                </div>
            `;
            container.appendChild(loadingOverlay);

            try {
                // é¢„åŠ è½½å¹¶å¤„ç†æ‰€æœ‰å›¾ç‰‡
                const processedImages = await Promise.all(
                    DEFAULT_DATA.spotDiff.flatMap(level => [
                        loadGameImage(level.image1),
                        loadGameImage(level.image2)
                    ])
                );

                // æ›´æ–°æ¸¸æˆæ•°æ®ä¸­çš„å›¾ç‰‡URL
                DEFAULT_DATA.spotDiff.forEach((level, i) => {
                    level.image1 = processedImages[i * 2];
                    level.image2 = processedImages[i * 2 + 1];
                });

                setTimeout(() => {
                    loadingOverlay.remove();
                    container.innerHTML = '';
                    container.appendChild(createGameStartUI());
                }, 500);
            } catch (error) {
                console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', error);
                loadingOverlay.querySelector('.loading-text').textContent = 'å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•';
            }
        }

        // å¼€å§‹æ¸¸æˆå…³å¡
        function startLevel(level) {
            const container = document.querySelector('#spotdiff-content');
            if (!container) return;
            
            window.spotDiffGame = new SpotDiffGame(DEFAULT_DATA);
            window.spotDiffGame.currentLevel = level;
            
            container.innerHTML = '';
            container.appendChild(window.spotDiffGame.createGameUI());
        }

        // åˆ†ç±»åˆ‡æ¢èƒ½
        function setCategory(category) {
            const tabs = document.querySelectorAll('.tab');
            const categoryTabs = document.querySelector('.category-tabs');
            const jokeText = document.querySelector('.joke-text');
            
            // å¦‚æœå·²ç»æ˜¯å½“å‰åˆ†ç±»ï¼Œä¸æ‰§è¡Œåˆ‡æ¢
            if (categoryTabs.dataset.active === category) return;
            
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // æ·»åŠ ç‚¹å‡»æ³¢çº¹æ•ˆæœ
            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            event.target.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
            
            // æ›´æ–°æŒ‡ç¤ºå™¨ä½ç½®
            categoryTabs.dataset.active = category;
            
            // æ·»åŠ åˆ‡æ¢åŠ¨ç”»
            jokeText.classList.add('switching');
            
            // å»¶è¿Ÿæ›´æ–°å†…å®¹
            setTimeout(() => {
                // æ ¹æ®åˆ†ç±»ç­›é€‰å†…å®¹
                const filteredQuotes = filterByCategory(category);
                const randomQuote = filteredQuotes[Math.floor(Math.random() * filteredQuotes.length)];
                updateQuoteContent(document.getElementById('joke-quote'), randomQuote);
                
                // ç§»é™¤åˆ‡æ¢åŠ¨ç”»
                jokeText.classList.remove('switching');
                
                // æ·»åŠ éœ‡åŠ¨åé¦ˆ
                if ('vibrate' in navigator) {
                    navigator.vibrate([20, 10, 20]);
                }
            }, 300);
        }

        // ä¼˜åŒ–æ ‡ç­¾å†…å®¹è¿‡æ»¤
        function filterByCategory(category) {
            if (category === 'all') return jokeQuotes;
            
            return jokeQuotes.filter(quote => {
                switch(category) {
                    case 'riddle':
                        return quote.startsWith('ç¯è°œï¼š');
                    case 'proverb':
                        return quote.startsWith('å†œè°šï¼š') || quote.startsWith('æ°‘è°šï¼š');
                    case 'trivia':
                        return quote.startsWith('å†·çŸ¥è¯†ï¼š') || quote.startsWith('ä½ çŸ¥é“å—ï¼š');
                    default:
                        return true;
                }
            });
        }

        // æ‰¾ä¸åŒæ¸¸æˆç±»
        class SpotDiffGame {
            constructor(gameData) {
                this.gameData = gameData;
                this.currentLevel = 0;
                this.score = 0;
                this.timeLeft = 0;
                this.foundDifferences = new Set();
                this.timer = null;
                this.isPaused = false;
            }

            createGameUI() {
                const level = this.gameData.spotDiff[this.currentLevel];
                const container = document.createElement('div');
                container.className = 'game-container';
                
                container.innerHTML = `
                    <div class="game-title">${level.title}</div>
                    <div class="game-info">
                        <div class="timer">æ—¶é—´: ${level.timeLimit}ç§’</div>
                        <div class="score">å¾—åˆ†: ${this.score}</div>
                        <button class="hint-button">æç¤º</button>
                    </div>
                    <div class="image-container">
                        <img src="${level.image1}" class="game-image" id="image1" alt="å›¾ç‰‡1">
                        <img src="${level.image2}" class="game-image" id="image2" alt="å›¾ç‰‡2">
                    </div>
                    <div class="game-controls">
                        <button class="control-button" onclick="window.spotDiffGame.restart()">é‡æ–°å¼€å§‹</button>
                        <button class="control-button pause-btn" onclick="window.spotDiffGame.togglePause()">æš‚åœ</button>
                    </div>
                `;

                this.setupEventListeners(container, level);
                return container;
            }

            setupEventListeners(container, level) {
                const images = container.querySelectorAll('.game-image');
                images.forEach(img => {
                    img.addEventListener('load', () => {
                        img.classList.add('loaded');
                    });

                    img.addEventListener('click', (e) => {
                        const rect = e.target.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        this.checkDifference(x, y, level);
                    });
                });

                container.querySelector('.hint-button').addEventListener('click', () => {
                    this.showHint(level);
                });

                this.startTimer(container, level.timeLimit);
            }

            checkDifference(x, y, level) {
                if (this.isPaused) return;
                
                level.differences.forEach((diff, index) => {
                    const distance = Math.sqrt(Math.pow(x - diff.x, 2) + Math.pow(y - diff.y, 2));
                    if (distance <= diff.radius && !this.foundDifferences.has(index)) {
                        this.foundDifferences.add(index);
                        this.score += 100;
                        this.markDifference(diff);
                        this.updateScore();
                        
                        if (this.foundDifferences.size === level.differences.length) {
                            this.levelComplete();
                        }
                    }
                });
            }

            markDifference(diff) {
                const marker = document.createElement('div');
                marker.className = 'difference-marker';
                marker.style.cssText = `
                    left: ${diff.x - diff.radius}px;
                    top: ${diff.y - diff.radius}px;
                    width: ${diff.radius * 2}px;
                    height: ${diff.radius * 2}px;
                `;
                document.querySelector('.image-container').appendChild(marker);
            }

            startTimer(container, time) {
                this.timeLeft = time;
                const timerElement = container.querySelector('.timer');
                
                this.timer = setInterval(() => {
                    if (!this.isPaused) {
                        this.timeLeft--;
                        timerElement.textContent = `æ—¶é—´: ${this.timeLeft}ç§’`;
                        
                        if (this.timeLeft <= 0) {
                            this.gameOver();
                        }
                    }
                }, 1000);
            }

            showHint(level) {
                if (this.isPaused) return;
                
                const unFoundDiffs = level.differences.filter((_, index) => 
                    !this.foundDifferences.has(index)
                );
                
                if (unFoundDiffs.length > 0) {
                    const randomDiff = unFoundDiffs[Math.floor(Math.random() * unFoundDiffs.length)];
                    showCustomAlert('æç¤º', randomDiff.hint);
                    this.score -= 50;
                    this.updateScore();
                }
            }

            updateScore() {
                document.querySelector('.score').textContent = `å¾—åˆ†: ${this.score}`;
            }

            levelComplete() {
                clearInterval(this.timer);
                showCustomAlert('æ­å–œé€šå…³ï¼', `æ‚¨çš„å¾—åˆ†ï¼š${this.score}`, () => {
                    this.currentLevel++;
                    
                    if (this.currentLevel < this.gameData.spotDiff.length) {
                        const container = document.querySelector('.game-container');
                        container.replaceWith(this.createGameUI());
                    } else {
                        showCustomAlert('æ¸¸æˆå®Œæˆ', 'æ­å–œæ‚¨å®Œæˆäº†æ‰€æœ‰å…³å¡ï¼');
                        this.restart();
                    }
                });
            }

            gameOver() {
                clearInterval(this.timer);
                showCustomAlert('æ¸¸æˆç»“æŸ', `æ‚¨çš„å¾—åˆ†ï¼š${this.score}`, () => {
                    this.restart();
                });
            }

            restart() {
                this.score = 0;
                this.currentLevel = 0;
                this.foundDifferences.clear();
                clearInterval(this.timer);
                this.isPaused = false;
                
                const container = document.querySelector('.game-container');
                container.replaceWith(this.createGameUI());
            }

            togglePause() {
                this.isPaused = !this.isPaused;
                const pauseBtn = document.querySelector('.pause-btn');
                pauseBtn.textContent = this.isPaused ? 'ç»§ç»­' : 'æš‚åœ';
            }
        }

        // è‡ªå®šä¹‰æç¤ºæ¡†
        function showCustomAlert(title, content, callback) {
            const overlay = document.createElement('div');
            overlay.className = 'blur-overlay';
            document.body.appendChild(overlay);

            const alert = document.createElement('div');
            alert.className = 'custom-alert';
            alert.innerHTML = `
                <div class="custom-alert-title">${title}</div>
                <div class="custom-alert-content">${content}</div>
                <button class="custom-alert-button">ç¡®å®š</button>
            `;

            document.body.appendChild(alert);
            
            requestAnimationFrame(() => {
                overlay.classList.add('show');
                alert.classList.add('show');
            });

            alert.querySelector('button').onclick = () => {
                overlay.classList.remove('show');
                alert.classList.remove('show');
                
                setTimeout(() => {
                    overlay.remove();
                    alert.remove();
                    if (callback) callback();
                }, 300);
            };
        }

        // æ›¿æ¢åŸæœ‰çš„ alert
        function showAlert(message, callback) {
            const isScore = message.includes('å¾—åˆ†');
            const title = isScore ? 'æ¸¸æˆç»“æœ' : 'æç¤º';
            showCustomAlert(title, message, callback);
        }

        // ä¼˜åŒ–å›¾ç‰‡åŠ è½½é”™è¯¯å¤„ç†
        function loadGameImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = "anonymous";  // å…è®¸è·¨åŸŸ
                img.onload = () => {
                    // åˆ›å»ºcanvasæ¥å¤„ç†å›¾ç‰‡
                    const canvas = document.createElement('canvas');
                    canvas.width = 400;
                    canvas.height = 300;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, 400, 300);
                    
                    // è½¬æ¢ä¸ºbase64æ ¼å¼
                    const dataUrl = canvas.toDataURL('image/png');
                    resolve(dataUrl);
                };
                img.onerror = () => {
                    // ä½¿ç”¨å¤‡ç”¨å›¾ç‰‡
                    img.src = `https://picsum.photos/400/300?random=${Math.random()}`;
                };
                img.src = src;
            });
        }

        // æ·»åŠ å›¾ç‰‡åŠ è½½çŠ¶æ€æç¤º
        function showImageLoadingState(container, isLoading) {
            if (isLoading) {
                const loadingText = document.createElement('div');
                loadingText.className = 'loading-text';
                loadingText.textContent = 'æ­£åœ¨åŠ è½½å›¾ç‰‡...';
                container.appendChild(loadingText);
            } else {
                const loadingText = container.querySelector('.loading-text');
                if (loadingText) {
                    loadingText.remove();
                }
            }
        }

        // ç½‘ç»œæ•°æ®é…ç½®
        const API_CONFIG = {
            jokes: 'https://api.example.com/jokes',
            timeout: 5000,
            retries: 3
        };

        // åŠ è½½æ•°æ®
        async function loadData() {
            let retries = API_CONFIG.retries;
            
            while (retries > 0) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), API_CONFIG.timeout);
                    
                    const response = await fetch(API_CONFIG.jokes, {
                        signal: controller.signal
                    });
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) throw new Error('Network response was not ok');
                    
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.warn(`Failed to load data, retries left: ${retries - 1}`, error);
                    retries--;
                    
                    if (retries === 0) {
                        console.log('Using fallback data');
                        return jokeQuotes; // ä½¿ç”¨æœ¬åœ°æ•°æ®
                    }
                    
                    // ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
        }

        // ä¿®æ”¹åˆå§‹åŒ–å‡½æ•°
        async function init() {
            try {
                const data = await loadData();
                if (data && Array.isArray(data)) {
                    jokeQuotes = data;
                }
            } catch (error) {
                console.error('Failed to initialize data:', error);
            }
            
            generateQuote();
        }
    </script>
</body>
</html>