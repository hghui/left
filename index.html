<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Left</title>
    <link rel="stylesheet" href="common.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
</head>
<body>
    <!-- åŠ¨æ€èƒŒæ™¯ -->
    <div class="background-shapes">
        <div class="heart-pink"></div>
        <div class="heart-blue"></div>
    </div>

    <div class="main-container">
        <!-- è®¡æ—¶å™¨æ¿å— -->
        <section class="timer-section">
            <div class="time-display">
                <div id="current-time" class="current-time"></div>
                <div id="lunar-info" class="lunar-info"></div>
            </div>
            
            <div class="love-timer">
                <div class="timer-label">åœ¨ä¸€èµ·å·²ç»</div>
                <div id="love-timer"></div>
            </div>
        </section>

        <!-- åŠŸèƒ½æ¿å— -->
        <section class="features-section">
            <div class="feature-card" data-feature="love">
                <div class="icon">ğŸ’Œ</div>
                <h3>æƒ…è¯æ—¶å…‰</h3>
                <p>æ¸©é¦¨æµªæ¼«çš„æƒ…è¯åˆ†äº«</p>
            </div>
            
            <div class="feature-card" data-feature="parenting">
                <div class="icon">ğŸ‘¶</div>
                <h3>è‚²å„¿çŸ¥è¯†</h3>
                <p>ä¸“ä¸šçš„è‚²å„¿å»ºè®®</p>
            </div>
            
            <div class="feature-card" data-feature="fun">
                <div class="icon">ğŸ®</div>
                <h3>è¶£å‘³ç©ºé—´</h3>
                <p>æœ‰è¶£çš„äº’åŠ¨å†…å®¹</p>
            </div>
            
            <div class="feature-card" data-feature="fortune">
                <div class="icon">ğŸŒŸ</div>
                <h3>ä»Šæ—¥è¿åŠ¿</h3>
                <p>æ˜Ÿåº§è¿åŠ¿æŸ¥è¯¢</p>
            </div>
            
            <div class="feature-card" data-feature="about">
                <div class="icon">â„¹ï¸</div>
                <h3>å…³äºé¡¹ç›®</h3>
                <p>é¡¹ç›®ä»‹ç»ä¸è¯´æ˜</p>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–åŠŸèƒ½å¡ç‰‡
            function initFeatureCards() {
                const featureCards = document.querySelectorAll('.feature-card');
                if (!featureCards || featureCards.length === 0) return;

                featureCards.forEach((card, index) => {
                    if (!card) return;
                    
                    card.style.setProperty('--i', index);
                    card.addEventListener('click', (e) => {
                        e.preventDefault();
                        const feature = card.dataset.feature;
                        if (!feature) return;
                        
                        // æ·»åŠ ç‚¹å‡»åé¦ˆ
                        card.style.transform = 'scale(0.98)';
                        setTimeout(() => {
                            card.style.transform = '';
                            
                            switch(feature) {
                                case 'love':
                                    window.location.href = 'love.html';
                                    break;
                                case 'parenting':
                                    window.location.href = 'parenting.html';
                                    break;
                                case 'fun':
                                    window.location.href = 'joke.html';
                                    break;
                                case 'fortune':
                                    showFortuneModal();
                                    break;
                                case 'about':
                                    window.location.href = 'about.html';
                                    break;
                            }
                        }, 150);
                    });
                });
            }

            // åˆå§‹åŒ–è®¡æ—¶å™¨
            function initializeTimers() {
                function updateTime() {
                    const timeElement = document.getElementById('current-time');
                    const lunarElement = document.getElementById('lunar-info');
                    
                    if (!timeElement || !lunarElement) return;
                    
                    const now = new Date();
                    timeElement.textContent = now.toLocaleTimeString('zh-CN');
                    
                    const lunar = Lunar.fromDate(now);
                    lunarElement.innerHTML = `
                        ${lunar.getYearInGanZhi()}å¹´ ${lunar.getMonthInChinese()}æœˆ${lunar.getDayInChinese()} 
                    `;
                }

                function updateLoveTimer() {
                    const loveTimerElement = document.getElementById('love-timer');
                    if (!loveTimerElement) return;
                    
                    const startDate = new Date('2022-08-19');
                    const now = new Date();
                    const diff = now - startDate;
                    
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    loveTimerElement.textContent = `${days}å¤© ${hours}æ—¶ ${minutes}åˆ† ${seconds}ç§’`;
                }

                updateTime();
                updateLoveTimer();
                setInterval(updateTime, 1000);
                setInterval(updateLoveTimer, 1000);
            }

            // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
            try {
                initFeatureCards();
                initializeTimers();
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
            }

            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            setTimeout(() => {
                showDynamicIsland('æ¬¢è¿å›æ¥ï¼ä»Šå¤©ä¹Ÿè¦å¼€å¿ƒå“¦ ğŸ’–');
            }, 1000);

            // æ˜¾ç¤ºçµåŠ¨å²›
            setTimeout(() => {
                initDynamicIsland();
            }, 1000);

            // æ·»åŠ é¼ æ ‡è·Ÿè¸ªå‘å…‰æ•ˆæœ
            const cards = document.querySelectorAll('.feature-card');
            const container = document.querySelector('.features-section');

            // æ›´æ–°é¼ æ ‡ä½ç½®å˜é‡
            function handleMouseMove(e) {
                const cards = document.querySelectorAll('.feature-card');
                cards.forEach(card => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    card.style.setProperty('--mouse-x', `${x}px`);
                    card.style.setProperty('--mouse-y', `${y}px`);
                });
            }

            // å¤„ç†å¡ç‰‡çš„å‘å…‰æ•ˆæœä¼ æ’­
            function handleCardHover(e) {
                const hoveredCard = e.currentTarget;
                const cards = document.querySelectorAll('.feature-card');
                const index = Array.from(cards).indexOf(hoveredCard);
                
                cards.forEach((card, i) => {
                    const distance = Math.abs(i - index);
                    const delay = distance * 100;
                    const opacity = Math.max(0, 1 - distance * 0.3);
                    
                    card.style.transition = `all 0.3s ease ${delay}ms`;
                    if (distance <= 2) { // åªå½±å“ç›¸é‚»çš„ä¸¤å¼ å¡ç‰‡
                        card.style.setProperty('--glow-opacity', opacity.toString());
                        card.classList.add('neighbor-glow');
                    }
                });
            }

            // ç§»é™¤å‘å…‰æ•ˆæœ
            function handleCardLeave() {
                const cards = document.querySelectorAll('.feature-card');
                cards.forEach(card => {
                    card.style.transition = 'all 0.3s ease';
                    card.style.setProperty('--glow-opacity', '0');
                    card.classList.remove('neighbor-glow');
                });
            }

            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            if (container) {
                container.addEventListener('mousemove', handleMouseMove);
                cards.forEach(card => {
                    card.addEventListener('mouseenter', handleCardHover);
                    card.addEventListener('mouseleave', handleCardLeave);
                });
            }
        });

        // çµåŠ¨å²›æ•°æ®è·å–å’Œæ˜¾ç¤º
        async function showDynamicIsland() {
            try {
                // è·å–APIæ•°æ®
                const response = await fetch('https://api.kuleu.com/api/getGreetingMessage?type=json');
                const result = await response.json();
                
                if (result.code === 200) {
                    const data = result.data;
                    
                    // ç§»é™¤å·²å­˜åœ¨çš„çµåŠ¨å²›
                    document.querySelectorAll('.dynamic-island, .dynamic-island-overlay').forEach(el => el.remove());

                    // åˆ›å»ºæ–°çš„çµåŠ¨å²›
                    const island = document.createElement('div');
                    island.className = 'dynamic-island';
                    
                    const overlay = document.createElement('div');
                    overlay.className = 'dynamic-island-overlay';
                    
                    // æ„å»ºå†…å®¹
                    const content = `
                        <div class="modal-content">
                            <div class="greeting-content">
                                <div class="greeting-time">${data.currentTime}</div>
                                <div class="greeting-message">${data.greeting}</div>
                                ${data.tip ? `<div class="greeting-tip">${data.tip}</div>` : ''}
                            </div>
                        </div>
                    `;
                    
                    island.innerHTML = content;
                    
                    // æ·»åŠ åˆ°é¡µé¢
                    document.body.appendChild(overlay);
                    document.body.appendChild(island);
                    
                    // æ˜¾ç¤ºåŠ¨ç”»
                    requestAnimationFrame(() => {
                        island.classList.add('show');
                    });

                    // ç‚¹å‡»é®ç½©å±‚å…³é—­çµåŠ¨å²›
                    overlay.addEventListener('click', closeDynamicIsland);
                    
                    // è§¦æ‘¸äº‹ä»¶æ”¯æŒ
                    overlay.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        closeDynamicIsland();
                    });

                    // è‡ªåŠ¨å…³é—­
                    setTimeout(() => {
                        closeDynamicIsland();
                    }, 5000); // 5ç§’åè‡ªåŠ¨å…³é—­
                    
                } else {
                    console.error('APIè¿”å›é”™è¯¯:', result.msg);
                }
            } catch (error) {
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
            }
        }

        // å®šæ—¶åˆ·æ–°çµåŠ¨å²›
        function initDynamicIsland() {
            // é¦–æ¬¡æ˜¾ç¤º
            showDynamicIsland();

            // æ¯éš”ä¸€æ®µæ—¶é—´åˆ·æ–°ä¸€æ¬¡
            setInterval(() => {
                showDynamicIsland();
            }, 30 * 60 * 1000); // æ¯30åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡
        }

        // å…³çµåŠ¨å²›
        function closeDynamicIsland() {
            const island = document.querySelector('.dynamic-island');
            const overlay = document.querySelector('.dynamic-island-overlay');
            
            if (island && overlay) {
                island.classList.add('fade-out');
                setTimeout(() => {
                    island.remove();
                    overlay.remove();
                }, 600);
            }
        }
    </script>
</body>
</html> 