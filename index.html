<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Left</title>
    <link rel="stylesheet" href="common.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
</head>
<body>
    <!-- 动态背景 -->
    <div class="background-shapes">
        <div class="heart-pink"></div>
        <div class="heart-blue"></div>
    </div>

    <div class="main-container">
        <!-- 计时器板块 -->
        <section class="timer-section">
            <div class="time-display">
                <div id="current-time" class="current-time"></div>
                <div id="lunar-info" class="lunar-info"></div>
            </div>
            
            <div class="love-timer">
                <div class="timer-label">在一起已经</div>
                <div id="love-timer"></div>
            </div>
        </section>

        <!-- 功能板块 -->
        <section class="features-section">
            <div class="feature-card" data-feature="love">
                <div class="icon">💌</div>
                <h3>情话时光</h3>
                <p>温馨浪漫的情话分享</p>
            </div>
            
            <div class="feature-card" data-feature="parenting">
                <div class="icon">👶</div>
                <h3>育儿知识</h3>
                <p>专业的育儿建议</p>
            </div>
            
            <div class="feature-card" data-feature="fun">
                <div class="icon">🎮</div>
                <h3>趣味空间</h3>
                <p>有趣的互动内容</p>
            </div>
            
            <div class="feature-card" data-feature="fortune">
                <div class="icon">🌟</div>
                <h3>今日运势</h3>
                <p>星座运势查询</p>
            </div>
            
            <div class="feature-card" data-feature="about">
                <div class="icon">ℹ️</div>
                <h3>关于项目</h3>
                <p>项目介绍与说明</p>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化功能卡片
            function initFeatureCards() {
                const featureCards = document.querySelectorAll('.feature-card');
                if (!featureCards || featureCards.length === 0) return;

                featureCards.forEach((card, index) => {
                    if (!card) return;
                    
                    card.style.setProperty('--i', index);
                    card.addEventListener('click', (e) => {
                        e.preventDefault();
                        const feature = card.dataset.feature;
                        if (!feature) return;
                        
                        // 添加点击反馈
                        card.style.transform = 'scale(0.98)';
                        setTimeout(() => {
                            card.style.transform = '';
                            
                            switch(feature) {
                                case 'love':
                                    window.location.href = 'love.html';
                                    break;
                                case 'parenting':
                                    window.location.href = 'parenting.html';
                                    break;
                                case 'fun':
                                    window.location.href = 'joke.html';
                                    break;
                                case 'fortune':
                                    showFortuneModal();
                                    break;
                                case 'about':
                                    window.location.href = 'about.html';
                                    break;
                            }
                        }, 150);
                    });
                });
            }

            // 初始化计时器
            function initializeTimers() {
                function updateTime() {
                    const timeElement = document.getElementById('current-time');
                    const lunarElement = document.getElementById('lunar-info');
                    
                    if (!timeElement || !lunarElement) return;
                    
                    const now = new Date();
                    timeElement.textContent = now.toLocaleTimeString('zh-CN');
                    
                    const lunar = Lunar.fromDate(now);
                    lunarElement.innerHTML = `
                        ${lunar.getYearInGanZhi()}年 ${lunar.getMonthInChinese()}月${lunar.getDayInChinese()} 
                    `;
                }

                function updateLoveTimer() {
                    const loveTimerElement = document.getElementById('love-timer');
                    if (!loveTimerElement) return;
                    
                    const startDate = new Date('2022-08-19');
                    const now = new Date();
                    const diff = now - startDate;
                    
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    loveTimerElement.textContent = `${days}天 ${hours}时 ${minutes}分 ${seconds}秒`;
                }

                updateTime();
                updateLoveTimer();
                setInterval(updateTime, 1000);
                setInterval(updateLoveTimer, 1000);
            }

            // 初始化所有功能
            try {
                initFeatureCards();
                initializeTimers();
            } catch (error) {
                console.error('初始化失败:', error);
            }

            // 显示欢迎信息
            setTimeout(() => {
                showDynamicIsland('欢迎回来！今天也要开心哦 💖');
            }, 1000);

            // 显示灵动岛
            setTimeout(() => {
                initDynamicIsland();
            }, 1000);

            // 添加鼠标跟踪发光效果
            const cards = document.querySelectorAll('.feature-card');
            const container = document.querySelector('.features-section');

            // 更新鼠标位置变量
            function handleMouseMove(e) {
                const cards = document.querySelectorAll('.feature-card');
                cards.forEach(card => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    card.style.setProperty('--mouse-x', `${x}px`);
                    card.style.setProperty('--mouse-y', `${y}px`);
                });
            }

            // 处理卡片的发光效果传播
            function handleCardHover(e) {
                const hoveredCard = e.currentTarget;
                const cards = document.querySelectorAll('.feature-card');
                const index = Array.from(cards).indexOf(hoveredCard);
                
                cards.forEach((card, i) => {
                    const distance = Math.abs(i - index);
                    const delay = distance * 100;
                    const opacity = Math.max(0, 1 - distance * 0.3);
                    
                    card.style.transition = `all 0.3s ease ${delay}ms`;
                    if (distance <= 2) { // 只影响相邻的两张卡片
                        card.style.setProperty('--glow-opacity', opacity.toString());
                        card.classList.add('neighbor-glow');
                    }
                });
            }

            // 移除发光效果
            function handleCardLeave() {
                const cards = document.querySelectorAll('.feature-card');
                cards.forEach(card => {
                    card.style.transition = 'all 0.3s ease';
                    card.style.setProperty('--glow-opacity', '0');
                    card.classList.remove('neighbor-glow');
                });
            }

            // 添加事件监听器
            if (container) {
                container.addEventListener('mousemove', handleMouseMove);
                cards.forEach(card => {
                    card.addEventListener('mouseenter', handleCardHover);
                    card.addEventListener('mouseleave', handleCardLeave);
                });
            }
        });

        // 灵动岛数据获取和显示
        async function showDynamicIsland() {
            try {
                // 获取API数据
                const response = await fetch('https://api.kuleu.com/api/getGreetingMessage?type=json');
                const result = await response.json();
                
                if (result.code === 200) {
                    const data = result.data;
                    
                    // 移除已存在的灵动岛
                    document.querySelectorAll('.dynamic-island, .dynamic-island-overlay').forEach(el => el.remove());

                    // 创建新的灵动岛
                    const island = document.createElement('div');
                    island.className = 'dynamic-island';
                    
                    const overlay = document.createElement('div');
                    overlay.className = 'dynamic-island-overlay';
                    
                    // 构建内容
                    const content = `
                        <div class="modal-content">
                            <div class="greeting-content">
                                <div class="greeting-time">${data.currentTime}</div>
                                <div class="greeting-message">${data.greeting}</div>
                                ${data.tip ? `<div class="greeting-tip">${data.tip}</div>` : ''}
                            </div>
                        </div>
                    `;
                    
                    island.innerHTML = content;
                    
                    // 添加到页面
                    document.body.appendChild(overlay);
                    document.body.appendChild(island);
                    
                    // 显示动画
                    requestAnimationFrame(() => {
                        island.classList.add('show');
                    });

                    // 点击遮罩层关闭灵动岛
                    overlay.addEventListener('click', closeDynamicIsland);
                    
                    // 触摸事件支持
                    overlay.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        closeDynamicIsland();
                    });

                    // 自动关闭
                    setTimeout(() => {
                        closeDynamicIsland();
                    }, 5000); // 5秒后自动关闭
                    
                } else {
                    console.error('API返回错误:', result.msg);
                }
            } catch (error) {
                console.error('获取数据失败:', error);
            }
        }

        // 定时刷新灵动岛
        function initDynamicIsland() {
            // 首次显示
            showDynamicIsland();

            // 每隔一段时间刷新一次
            setInterval(() => {
                showDynamicIsland();
            }, 30 * 60 * 1000); // 每30分钟刷新一次
        }

        // 关灵动岛
        function closeDynamicIsland() {
            const island = document.querySelector('.dynamic-island');
            const overlay = document.querySelector('.dynamic-island-overlay');
            
            if (island && overlay) {
                island.classList.add('fade-out');
                setTimeout(() => {
                    island.remove();
                    overlay.remove();
                }, 600);
            }
        }
    </script>
</body>
</html> 