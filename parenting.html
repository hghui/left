<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚²å„¿ - Left</title>
    <link rel="stylesheet" href="common.css">
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(-45deg, #ffcce6, #b3e0ff, #ffcce6, #99d6ff);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .parenting-container {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 102, 179, 0.15);
            width: min(90vw, 600px);
            position: relative;
            will-change: transform;
            backface-visibility: hidden;
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tip-text {
            font-size: clamp(1rem, 4vw, 1.5rem);
            color: #ff6699;
            margin: 20px;
            line-height: 1.6;
            font-family: 'Ma Shan Zheng', cursive;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.8);
        }

        .tip-source {
            display: inline-block;
            padding: 2px 8px;
            background: linear-gradient(120deg, #ff99cc, #99ccff);
            color: white;
            border-radius: 12px;
            font-size: 0.8em;
            margin-right: 8px;
            box-shadow: 0 2px 4px rgba(255, 153, 204, 0.2);
        }

        .tip-from {
            color: #ff99cc;
            font-size: 0.9em;
        }

        .new-tip {
            padding: 12px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 25px;
            background: linear-gradient(120deg, #ff99cc, #99ccff);
            color: white;
            font-family: 'Ma Shan Zheng', cursive;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(255, 153, 204, 0.2);
            position: relative;
            overflow: hidden;
        }

        .new-tip:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 153, 204, 0.3);
            background: linear-gradient(120deg, #ff80bf, #80bfff);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, rgba(255, 153, 204, 0.95), rgba(153, 204, 255, 0.95));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .loading-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.9);
            border-top-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-overlay p {
            margin-top: 15px;
            color: white;
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.1em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* å¤§å±å¹•é€‚é… */
        @media (min-width: 1440px) {
            .parenting-container {
                max-width: 800px;
                padding: 3rem;
            }

            .tip-text {
                font-size: 1.8rem;
            }

            .new-tip {
                padding: 15px 30px;
                font-size: 1.3em;
            }
        }

        /* å¹³æ¿é€‚é… */
        @media (min-width: 768px) and (max-width: 1024px) {
            .parenting-container {
                width: 80vw;
                padding: 2.5rem;
            }
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 767px) {
            body {
                padding: 10px;
            }

            .parenting-container {
                width: 95vw;
                padding: 1.5rem;
            }

            .tip-text {
                font-size: 1.2rem;
            }

            .tip-source {
                font-size: 0.75em;
                padding: 2px 6px;
            }

            .tip-from {
                font-size: 0.85em;
            }
        }

        /* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
        @media (hover: none) {
            .new-tip:hover {
                transform: none;
            }

            .parenting-container:hover {
                transform: none;
            }

            .home-button {
                opacity: 0.8;
            }
        }

        /* åŠ¨ç”»æ€§èƒ½ä¼˜åŒ– */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body>
    <div class="parenting-container">
        <div class="tip-text" id="parenting-tip"></div>
        <button class="new-tip" onclick="generateTip()">å†æ¥ä¸€æ¡</button>
    </div>
    <button class="home-button theme-parenting" onclick="goHome()">è¿”å›é¦–é¡µ</button>
    <div class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>æ­£åœ¨åŠ è½½è‚²å„¿å°çŸ¥è¯†...</p>
    </div>

    <script>
        // æ·»åŠ è¿”å›é¦–é¡µå‡½æ•°
        function goHome() {
            window.location.href = 'index.html';
        }

        // æœ¬åœ°æ•°æ®
        const localTips = [
            {
                source: "æœ¬åœ°",
                from: "å„¿ç§‘åŒ»ç”Ÿ",
                content: "0-6ä¸ªæœˆå®å®å»ºè®®çº¯æ¯ä¹³å–‚å…»ï¼Œå¯ä»¥æä¾›æœ€ä½³è¥å…»å’Œå…ç–«åŠ› ğŸ¼"
            },
            {
                source: "æœ¬åœ°",
                from: "å„¿ç§‘åŒ»ç”Ÿ",
                content: "æ–°ç”Ÿå„¿æ¯å¤©éœ€è¦16-20å°æ—¶çš„ç¡çœ ï¼Œæœ‰åŠ©äºå¤§è„‘å‘è‚²å’Œç”Ÿé•¿æ¿€ç´ åˆ†æ³Œ ğŸ˜´"
            },
            {
                source: "æœ¬åœ°",
                from: "ä¸­å›½è¥å…»å­¦ä¼š",
                content: "6ä¸ªæœˆåå¯ä»¥å¼€å§‹æ·»åŠ è¾…é£Ÿï¼Œä»ç±³ç³Šå¼€å§‹ï¼Œå¾ªåºæ¸è¿›æ·»åŠ è”¬èœæ³¥å’Œæ°´æœæ³¥ ğŸ¥£"
            },
            {
                source: "æœ¬åœ°",
                from: "ä¸­å›½ç–¾ç—…é¢„é˜²æ§åˆ¶ä¸­å¿ƒ",
                content: "å©´å„¿æ¯æœˆéƒ½è¦æŒ‰æ—¶ä½“æ£€å’Œæ¥ç§ç–«è‹—ï¼Œå»ºç«‹åŸºç¡€å…ç–«åŠ›å¾ˆé‡è¦ ğŸ’‰"
            },
            {
                source: "æœ¬åœ°",
                from: "ä¸­åæŠ¤ç†å­¦ä¼šå„¿ç§‘ä¸“ä¸šå§”å‘˜ä¼š",
                content: "ç»™å®å®æ´—æ¾¡æ°´æ¸©37-38åº¦ï¼Œå®¤æ¸©26-28åº¦ï¼Œé¿å…ç€å‡‰å†’ ğŸ›"
            },
            {
                source: "æœ¬åœ°",
                from: "ä¸­å›½å¦‡å¹¼ä¿å¥åä¼š",
                content: "å®å®å‡ºç°å‘çƒ§è…¹æ³»è¦åŠæ—¶å°±åŒ»ï¼Œåˆ«éšä¾¿æœç”¨æˆäººè¯ç‰© ğŸ¥"
            },
            {
                source: "æœ¬åœ°",
                from: "ä¸­å›½å­¦å‰æ•™è‚²ç ”ç©¶ä¼š",
                content: "3-6ä¸ªæœˆå¯ä»¥è¿›è¡Œç®€å•çš„æŠ“æ¡è®­ç»ƒï¼Œæœ‰åŠ©äºç²¾ç»†åŠ¨ä½œå‘å±• ğŸ¯"
            },
            {
                source: "æœ¬åœ°",
                from: "ä¸­å›½è¥å…»å­¦ä¼šå„¿ç«¥è¥å…»ä¸“ä¸šå§”å‘˜ä¼š",
                content: "1å²å†…çš„å®å®è¡¥å……ç»´ç”Ÿç´ Då¾ˆé‡è¦ï¼Œå¯ä»¥é¢„é˜²ä½å»ç—… ğŸŒ"
            },
            {
                source: "æœ¬åœ°",
                from: "ä¸­å›½ä¼˜ç”Ÿä¼˜è‚²åä¼š",
                content: "æ–°ç”Ÿå„¿æ¯å¤©è¦è§‚å¯Ÿå¤§å°ä¾¿æ¬¡æ•°å’Œæ€§çŠ¶ï¼Œäº†è§£å¥åº·çŠ¶å†µ ğŸ‘¶"
            },
            {
                source: "æœ¬åœ°",
                from: "ä¸­å›½å„¿ç«¥ä¿å¥åä¼š",
                content: "0-3å²æ˜¯è¯­è¨€å‘è‚²å…³é”®æœŸï¼Œè¦å¤šå’Œå®å®è¯´è¯äº’åŠ¨ ğŸ—£ï¸"
            },
            {
                source: "æœ¬åœ°",
                from: "ä¸­å›½å¦‡å¹¼ä¿å¥åä¼š",
                content: "å®å®çš„è¡£ç‰©è¦ç”¨ä¸“é—¨çš„å©´å„¿æ´—è¡£æ¶²æ¸…æ´—ï¼Œé¿å…åˆºæ¿€çš®è‚¤ ğŸ‘•"
            },
            {
                source: "æœ¬åœ°",
                from: "ä¸­å›½ä¼˜ç”Ÿç§‘å­¦åä¼š",
                content: "å®šæœŸæµ‹é‡èº«é«˜ä½“é‡ï¼Œå…³æ³¨å®å®ç”Ÿé•¿å‘è‚²æ›²çº¿ ğŸ“"
            }
        ];

        // APIé…ç½®
        const API_CONFIG = {
            url: 'https://api.apiopen.top/api/sentences',
            backupUrl: 'https://v1.hitokoto.cn',
            timeout: 5000,
            retryCount: 3,
            retryDelay: 1000
        };

        let tips = [...localTips];
        let isLoading = false;

        // é‡è¯•å‡½æ•°
        async function fetchWithRetry(url, options, retries = API_CONFIG.retryCount) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error('Network response was not ok');
                return await response.json();
            } catch (error) {
                if (retries > 0) {
                    await new Promise(resolve => setTimeout(resolve, API_CONFIG.retryDelay));
                    return fetchWithRetry(url, options, retries - 1);
                }
                throw error;
            }
        }

        // æ•°æ®æ ¼å¼åŒ–å‡½æ•°
        function formatTipData(data, source = 'ç½‘ç»œ') {
            if (data.result) {
                return {
                    source: source,
                    from: 'å„¿ç§‘åŒ»ç”Ÿ',
                    content: data.result.content || data.result.tip
                };
            } else if (data.tip) {
                return {
                    source: source,
                    from: 'å„¿ç§‘åŒ»ç”Ÿ',
                    content: data.tip
                };
            }
            return null;
        }

        // åœ¨æ²¡æœ‰ç½‘ç»œæ•°æ®æ—¶éšæœºç”Ÿæˆæœ¬åœ°æ•°æ®çš„ç»„åˆ
        function generateLocalTip() {
            const randomTips = [];
            const usedIndexes = new Set();

            // éšæœºé€‰æ‹©3æ¡æœ¬åœ°æ•°æ®ç»„åˆ
            while (randomTips.length < 3 && usedIndexes.size < localTips.length) {
                const index = Math.floor(Math.random() * localTips.length);
                if (!usedIndexes.has(index)) {
                    usedIndexes.add(index);
                    randomTips.push(localTips[index]);
                }
            }

            // ç»„åˆæˆæ–°çš„æç¤º
            if (randomTips.length > 0) {
                const combinedContent = randomTips
                    .map(tip => tip.content.replace(/[ğŸ¼ğŸ˜´ğŸ¥£ğŸ’‰ğŸ›ğŸ¥ğŸ¯ğŸŒğŸ‘¶ğŸ—£ï¸ğŸ‘•ğŸ“]/g, ''))
                    .join('ï¼›');
                
                return {
                    source: 'æœ¬åœ°',
                    from: 'å„¿ç§‘åŒ»ç”Ÿ',
                    content: combinedContent + ' ğŸ‘¶'
                };
            }

            return localTips[Math.floor(Math.random() * localTips.length)];
        }

        // åŠ è½½æ•°æ®
        async function loadTips() {
            if (isLoading) return;
            
            const loadingOverlay = document.querySelector('.loading-overlay');
            loadingOverlay.classList.add('show');
            isLoading = true;

            try {
                // ç›´æ¥ä½¿ç”¨æœ¬åœ°æ•°æ®
                tips = [...localTips];
                
                // éšæœºç»„åˆä¸€äº›æœ¬åœ°æ•°æ®ä½œä¸ºæ–°æç¤º
                const combinedTips = [];
                for (let i = 0; i < 5; i++) {
                    combinedTips.push(generateLocalTip());
                }
                
                tips = [...tips, ...combinedTips];
                
                localStorage.setItem('parenting_tips_cache', JSON.stringify({
                    timestamp: Date.now(),
                    data: tips
                }));
                
                // ç«‹å³ç§»é™¤åŠ è½½çŠ¶æ€
                loadingOverlay.classList.remove('show');
            } catch (error) {
                console.warn('Failed to load tips, using local data:', error);
                tips = [...localTips];
                loadingOverlay.classList.remove('show');
            } finally {
                isLoading = false;
            }
            
            // ç”Ÿæˆç¬¬ä¸€æ¡æç¤º
            generateTip();
        }

        // ç”Ÿæˆæç¤º
        function generateTip() {
            const tipElement = document.getElementById('parenting-tip');
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            
            tipElement.style.opacity = '0';
            setTimeout(() => {
                tipElement.innerHTML = `
                    <span class="tip-source">[${randomTip.source}]</span>
                    <span class="tip-from">${randomTip.from}ï¼š</span>
                    <span class="tip-content">${randomTip.content}</span>
                `;
                tipElement.style.opacity = '1';
            }, 300);
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', async () => {
            loadTips();
        });

        // å®šæœŸåˆ·æ–°æ•°æ®
        setInterval(() => {
            const randomTips = [];
            for (let i = 0; i < 3; i++) {
                randomTips.push(generateLocalTip());
            }
            tips = [...localTips, ...randomTips];
        }, 5 * 60 * 1000); // æ¯5åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡

        // ä½¿ç”¨ IntersectionObserver ä¼˜åŒ–åŠ¨ç”»è§¦å‘
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });

        // ä½¿ç”¨ requestIdleCallback ä¼˜åŒ–éå…³é”®ä»»åŠ¡
        const idleWork = (deadline) => {
            if (deadline.timeRemaining() > 0) {
                // æ‰§è¡Œéå…³é”®ä»»åŠ¡ï¼Œå¦‚æ•°æ®é¢„åŠ è½½ã€ç¼“å­˜æ¸…ç†ç­‰
            }
            requestIdleCallback(idleWork);
        };
        requestIdleCallback(idleWork);

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            // å¯ä»¥æ·»åŠ é”™è¯¯ä¸ŠæŠ¥é€»è¾‘
        });

        // Promise é”™è¯¯å¤„ç†
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            // å¯ä»¥æ·»åŠ é”™è¯¯ä¸ŠæŠ¥é€»è¾‘
        });
    </script>
</body>
</html> 