<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÇ≤ÂÑø - Left</title>
    <link rel="stylesheet" href="common.css">
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(-45deg, #ffcce6, #b3e0ff, #ffcce6, #99d6ff);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .parenting-container {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 102, 179, 0.15);
            width: min(90vw, 600px);
            position: relative;
            will-change: transform;
            backface-visibility: hidden;
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tip-text {
            font-size: clamp(1rem, 4vw, 1.5rem);
            color: #ff6699;
            margin: 20px;
            line-height: 1.6;
            font-family: 'Ma Shan Zheng', cursive;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.8);
        }

        .tip-source {
            display: inline-block;
            padding: 2px 8px;
            background: linear-gradient(120deg, #ff99cc, #99ccff);
            color: white;
            border-radius: 12px;
            font-size: 0.8em;
            margin-right: 8px;
            box-shadow: 0 2px 4px rgba(255, 153, 204, 0.2);
        }

        .tip-from {
            color: #ff99cc;
            font-size: 0.9em;
        }

        .new-tip {
            padding: 12px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 25px;
            background: linear-gradient(120deg, #ff99cc, #99ccff);
            color: white;
            font-family: 'Ma Shan Zheng', cursive;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(255, 153, 204, 0.2);
            position: relative;
            overflow: hidden;
        }

        .new-tip:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 153, 204, 0.3);
            background: linear-gradient(120deg, #ff80bf, #80bfff);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, rgba(255, 153, 204, 0.95), rgba(153, 204, 255, 0.95));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .loading-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.9);
            border-top-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-overlay p {
            margin-top: 15px;
            color: white;
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.1em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Â§ßÂ±èÂπïÈÄÇÈÖç */
        @media (min-width: 1440px) {
            .parenting-container {
                max-width: 800px;
                padding: 3rem;
            }

            .tip-text {
                font-size: 1.8rem;
            }

            .new-tip {
                padding: 15px 30px;
                font-size: 1.3em;
            }
        }

        /* Âπ≥ÊùøÈÄÇÈÖç */
        @media (min-width: 768px) and (max-width: 1024px) {
            .parenting-container {
                width: 80vw;
                padding: 2.5rem;
            }
        }

        /* ÁßªÂä®Á´ØÈÄÇÈÖç */
        @media (max-width: 767px) {
            body {
                padding: 10px;
            }

            .parenting-container {
                width: 95vw;
                padding: 1.5rem;
            }

            .tip-text {
                font-size: 1.2rem;
            }

            .tip-source {
                font-size: 0.75em;
                padding: 2px 6px;
            }

            .tip-from {
                font-size: 0.85em;
            }
        }

        /* Ëß¶Êë∏ËÆæÂ§á‰ºòÂåñ */
        @media (hover: none) {
            .new-tip:hover {
                transform: none;
            }

            .parenting-container:hover {
                transform: none;
            }

            .home-button {
                opacity: 0.8;
            }
        }

        /* Âä®ÁîªÊÄßËÉΩ‰ºòÂåñ */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body>
    <div class="parenting-container">
        <div class="tip-text" id="parenting-tip"></div>
        <button class="new-tip" onclick="generateTip()">ÂÜçÊù•‰∏ÄÊù°</button>
    </div>
    <button class="home-button theme-parenting" onclick="goHome()">ËøîÂõûÈ¶ñÈ°µ</button>
    <div class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Ê≠£Âú®Âä†ËΩΩËÇ≤ÂÑøÂ∞èÁü•ËØÜ...</p>
    </div>

    <script>
        // Ê∑ªÂä†ËøîÂõûÈ¶ñÈ°µÂáΩÊï∞
        function goHome() {
            window.location.href = 'index.html';
        }

        // Êú¨Âú∞Êï∞ÊçÆ
        const localTips = [
            {
                source: "Êú¨Âú∞",
                from: "ÂÑøÁßëÂåªÁîü",
                content: "0-6‰∏™ÊúàÂÆùÂÆùÂª∫ËÆÆÁ∫ØÊØç‰π≥ÂñÇÂÖªÔºåÂèØ‰ª•Êèê‰æõÊúÄ‰Ω≥Ëê•ÂÖªÂíåÂÖçÁñ´Âäõ üçº"
            },
            {
                source: "Êú¨Âú∞",
                from: "ÂÑøÁßëÂåªÁîü",
                content: "Êñ∞ÁîüÂÑøÊØèÂ§©ÈúÄË¶Å16-20Â∞èÊó∂ÁöÑÁù°Áú†ÔºåÊúâÂä©‰∫éÂ§ßËÑëÂèëËÇ≤ÂíåÁîüÈïøÊøÄÁ¥†ÂàÜÊ≥å üò¥"
            },
            {
                source: "Êú¨Âú∞",
                from: "‰∏≠ÂõΩËê•ÂÖªÂ≠¶‰ºö",
                content: "6‰∏™ÊúàÂêéÂèØ‰ª•ÂºÄÂßãÊ∑ªÂä†ËæÖÈ£üÔºå‰ªéÁ±≥Á≥äÂºÄÂßãÔºåÂæ™Â∫èÊ∏êËøõÊ∑ªÂä†Ëî¨ËèúÊ≥•ÂíåÊ∞¥ÊûúÊ≥• ü•£"
            },
            {
                source: "Êú¨Âú∞",
                from: "‰∏≠ÂõΩÁñæÁóÖÈ¢ÑÈò≤ÊéßÂà∂‰∏≠ÂøÉ",
                content: "Â©¥ÂÑøÊØèÊúàÈÉΩË¶ÅÊåâÊó∂‰ΩìÊ£ÄÂíåÊé•ÁßçÁñ´ËãóÔºåÂª∫Á´ãÂü∫Á°ÄÂÖçÁñ´ÂäõÂæàÈáçË¶Å üíâ"
            },
            {
                source: "Êú¨Âú∞",
                from: "‰∏≠ÂçéÊä§ÁêÜÂ≠¶‰ºöÂÑøÁßë‰∏ì‰∏öÂßîÂëò‰ºö",
                content: "ÁªôÂÆùÂÆùÊ¥óÊæ°Ê∞¥Ê∏©37-38Â∫¶ÔºåÂÆ§Ê∏©26-28Â∫¶ÔºåÈÅøÂÖçÁùÄÂáâÂÜí üõÅ"
            },
            {
                source: "Êú¨Âú∞",
                from: "‰∏≠ÂõΩÂ¶áÂπº‰øùÂÅ•Âçè‰ºö",
                content: "ÂÆùÂÆùÂá∫Áé∞ÂèëÁÉßËÖπÊ≥ªË¶ÅÂèäÊó∂Â∞±ÂåªÔºåÂà´Èöè‰æøÊúçÁî®Êàê‰∫∫ËçØÁâ© üè•"
            },
            {
                source: "Êú¨Âú∞",
                from: "‰∏≠ÂõΩÂ≠¶ÂâçÊïôËÇ≤Á†îÁ©∂‰ºö",
                content: "3-6‰∏™ÊúàÂèØ‰ª•ËøõË°åÁÆÄÂçïÁöÑÊäìÊè°ËÆ≠ÁªÉÔºåÊúâÂä©‰∫éÁ≤æÁªÜÂä®‰ΩúÂèëÂ±ï üéØ"
            },
            {
                source: "Êú¨Âú∞",
                from: "‰∏≠ÂõΩËê•ÂÖªÂ≠¶‰ºöÂÑøÁ´•Ëê•ÂÖª‰∏ì‰∏öÂßîÂëò‰ºö",
                content: "1Â≤ÅÂÜÖÁöÑÂÆùÂÆùË°•ÂÖÖÁª¥ÁîüÁ¥†DÂæàÈáçË¶ÅÔºåÂèØ‰ª•È¢ÑÈò≤‰ΩùÂÅªÁóÖ üåû"
            },
            {
                source: "Êú¨Âú∞",
                from: "‰∏≠ÂõΩ‰ºòÁîü‰ºòËÇ≤Âçè‰ºö",
                content: "Êñ∞ÁîüÂÑøÊØèÂ§©Ë¶ÅËßÇÂØüÂ§ßÂ∞è‰æøÊ¨°Êï∞ÂíåÊÄßÁä∂Ôºå‰∫ÜËß£ÂÅ•Â∫∑Áä∂ÂÜµ üë∂"
            },
            {
                source: "Êú¨Âú∞",
                from: "‰∏≠ÂõΩÂÑøÁ´•‰øùÂÅ•Âçè‰ºö",
                content: "0-3Â≤ÅÊòØËØ≠Ë®ÄÂèëËÇ≤ÂÖ≥ÈîÆÊúüÔºåË¶ÅÂ§öÂíåÂÆùÂÆùËØ¥ËØù‰∫íÂä® üó£Ô∏è"
            },
            {
                source: "Êú¨Âú∞",
                from: "‰∏≠ÂõΩÂ¶áÂπº‰øùÂÅ•Âçè‰ºö",
                content: "ÂÆùÂÆùÁöÑË°£Áâ©Ë¶ÅÁî®‰∏ìÈó®ÁöÑÂ©¥ÂÑøÊ¥óË°£Ê∂≤Ê∏ÖÊ¥óÔºåÈÅøÂÖçÂà∫ÊøÄÁöÆËÇ§ üëï"
            },
            {
                source: "Êú¨Âú∞",
                from: "‰∏≠ÂõΩ‰ºòÁîüÁßëÂ≠¶Âçè‰ºö",
                content: "ÂÆöÊúüÊµãÈáèË∫´È´ò‰ΩìÈáçÔºåÂÖ≥Ê≥®ÂÆùÂÆùÁîüÈïøÂèëËÇ≤Êõ≤Á∫ø üìè"
            }
        ];

        // APIÈÖçÁΩÆ
        const API_CONFIG = {
            url: 'https://api.apiopen.top/api/sentences',
            backupUrl: 'https://v1.hitokoto.cn',
            timeout: 5000,
            retryCount: 3,
            retryDelay: 1000
        };

        let tips = [...localTips];
        let isLoading = false;

        // ÈáçËØïÂáΩÊï∞
        async function fetchWithRetry(url, options, retries = API_CONFIG.retryCount) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error('Network response was not ok');
                return await response.json();
            } catch (error) {
                if (retries > 0) {
                    await new Promise(resolve => setTimeout(resolve, API_CONFIG.retryDelay));
                    return fetchWithRetry(url, options, retries - 1);
                }
                throw error;
            }
        }

        // Êï∞ÊçÆÊ†ºÂºèÂåñÂáΩÊï∞
        function formatTipData(data, source = 'ÁΩëÁªú') {
            if (data.result) {
                return {
                    source: source,
                    from: 'ÂÑøÁßëÂåªÁîü',
                    content: data.result.content || data.result.tip
                };
            } else if (data.tip) {
                return {
                    source: source,
                    from: 'ÂÑøÁßëÂåªÁîü',
                    content: data.tip
                };
            }
            return null;
        }

        // Âú®Ê≤°ÊúâÁΩëÁªúÊï∞ÊçÆÊó∂ÈöèÊú∫ÁîüÊàêÊú¨Âú∞Êï∞ÊçÆÁöÑÁªÑÂêà
        function generateLocalTip() {
            const randomTips = [];
            const usedIndexes = new Set();

            // ÈöèÊú∫ÈÄâÊã©3Êù°Êú¨Âú∞Êï∞ÊçÆÁªÑÂêà
            while (randomTips.length < 3 && usedIndexes.size < localTips.length) {
                const index = Math.floor(Math.random() * localTips.length);
                if (!usedIndexes.has(index)) {
                    usedIndexes.add(index);
                    randomTips.push(localTips[index]);
                }
            }

            // ÁªÑÂêàÊàêÊñ∞ÁöÑÊèêÁ§∫
            if (randomTips.length > 0) {
                const combinedContent = randomTips
                    .map(tip => tip.content.replace(/[üçºüò¥ü•£üíâüõÅüè•üéØüåûüë∂üó£Ô∏èüëïüìè]/g, ''))
                    .join('Ôºõ');
                
                return {
                    source: 'Êú¨Âú∞',
                    from: 'ÂÑøÁßëÂåªÁîü',
                    content: combinedContent + ' üë∂'
                };
            }

            return localTips[Math.floor(Math.random() * localTips.length)];
        }

        // Âä†ËΩΩÊï∞ÊçÆ
        async function loadTips() {
            if (isLoading) return;
            
            const loadingOverlay = document.querySelector('.loading-overlay');
            loadingOverlay.classList.add('show');
            isLoading = true;

            try {
                // Áõ¥Êé•‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆ
                tips = [...localTips];
                
                // ÈöèÊú∫ÁªÑÂêà‰∏Ä‰∫õÊú¨Âú∞Êï∞ÊçÆ‰Ωú‰∏∫Êñ∞ÊèêÁ§∫
                const combinedTips = [];
                for (let i = 0; i < 5; i++) {
                    combinedTips.push(generateLocalTip());
                }
                
                tips = [...tips, ...combinedTips];
                
                localStorage.setItem('parenting_tips_cache', JSON.stringify({
                    timestamp: Date.now(),
                    data: tips
                }));
                
                // Á´ãÂç≥ÁßªÈô§Âä†ËΩΩÁä∂ÊÄÅ
                loadingOverlay.classList.remove('show');
            } catch (error) {
                console.warn('Failed to load tips, using local data:', error);
                tips = [...localTips];
                loadingOverlay.classList.remove('show');
            } finally {
                isLoading = false;
            }
            
            // ÁîüÊàêÁ¨¨‰∏ÄÊù°ÊèêÁ§∫
            generateTip();
        }

        // ÁîüÊàêÊèêÁ§∫
        function generateTip() {
            const tipElement = document.getElementById('parenting-tip');
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            
            tipElement.style.opacity = '0';
            setTimeout(() => {
                tipElement.innerHTML = `
                    <span class="tip-source">[${randomTip.source}]</span>
                    <span class="tip-from">${randomTip.from}Ôºö</span>
                    <span class="tip-content">${randomTip.content}</span>
                `;
                tipElement.style.opacity = '1';
            }, 300);
        }

        // ÂàùÂßãÂåñ
        window.addEventListener('load', async () => {
            loadTips();
        });

        // ÂÆöÊúüÂà∑Êñ∞Êï∞ÊçÆ
        setInterval(() => {
            const randomTips = [];
            for (let i = 0; i < 3; i++) {
                randomTips.push(generateLocalTip());
            }
            tips = [...localTips, ...randomTips];
        }, 5 * 60 * 1000); // ÊØè5ÂàÜÈíüÂà∑Êñ∞‰∏ÄÊ¨°

        // ‰ΩøÁî® IntersectionObserver ‰ºòÂåñÂä®ÁîªËß¶Âèë
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });

        // ‰ΩøÁî® requestIdleCallback ‰ºòÂåñÈùûÂÖ≥ÈîÆ‰ªªÂä°
        const idleWork = (deadline) => {
            if (deadline.timeRemaining() > 0) {
                // ÊâßË°åÈùûÂÖ≥ÈîÆ‰ªªÂä°ÔºåÂ¶ÇÊï∞ÊçÆÈ¢ÑÂä†ËΩΩ„ÄÅÁºìÂ≠òÊ∏ÖÁêÜÁ≠â
            }
            requestIdleCallback(idleWork);
        };
        requestIdleCallback(idleWork);

        // ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜ
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            // ÂèØ‰ª•Ê∑ªÂä†ÈîôËØØ‰∏äÊä•ÈÄªËæë
        });

        // Promise ÈîôËØØÂ§ÑÁêÜ
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            // ÂèØ‰ª•Ê∑ªÂä†ÈîôËØØ‰∏äÊä•ÈÄªËæë
        });
    </script>
</body>
</html> 